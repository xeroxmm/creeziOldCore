<?php
require_once("check_blacklist_IPSet.php");
use IPSet\IPSet;
/*
$t = microtime();
var_dump(check_blacklist($_GET["ip"]));
echo " (".((microtime()-$t)*1000)." ms)";
*/

function check_blacklist($ip = ""){
  if($ip == ""){
    $ip = $_SERVER['REMOTE_ADDR'];
  }
  if($ip == "95.90.211.84")
    return false;
  $sp = explode(".",$ip);
  if(sizeof($sp) == 4){
    if(file_exists(dirname(__FILE__)."/bad/".$sp[0]."/".$sp[1]."/".$sp[2])){
      $a = explode("\n",file_get_contents(dirname(__FILE__)."/bad/".$sp[0]."/".$sp[1]."/".$sp[2]));
      if(in_array($sp[3],$a))
        return true;
    }
  }

  $ipset = new IPSet(array(
  "14.4.0.0/14",
  "42.128.0.0/12",
  "42.160.0.0/12",
  "116.136.0.0/13",
  "116.156.0.0/14",
  "116.160.0.0/13",
  "116.184.0.0/13",
  "1.208.0.0/12",
  "1.232.0.0/13",
  "1.240.0.0/12",
  "14.32.0.0/13",
  "59.16.0.0/13",
  "61.32.0.0/13",
  "61.72.0.0/13",
  "61.80.0.0/14",
  "106.240.0.0/12",
  "112.160.0.0/12",
  "112.216.0.0/13",
  "115.16.0.0/13",
  "115.88.0.0/13",
  "118.32.0.0/12",
  "118.128.0.0/14",
  "119.192.0.0/12",
  "121.128.0.0/12",
  "121.152.0.0/13",
  "121.160.0.0/11",
  "122.32.0.0/13",
  "123.140.0.0/14",
  "123.212.0.0/14",
  "125.128.0.0/13",
  "175.112.0.0/12",
  "175.192.0.0/12",
  "175.208.0.0/13",
  "180.224.0.0/14",
  "182.216.0.0/13",
  "183.96.0.0/13",
  "211.104.0.0/14",
  "211.192.0.0/12",
  "211.224.0.0/13",
  "218.52.0.0/14",
  "218.144.0.0/12",
  "219.248.0.0/14",
  "220.72.0.0/13",
  "220.120.0.0/13",
  "221.140.0.0/14",
  "221.144.0.0/12",
  "221.160.0.0/13",
  "222.96.0.0/13",
  "222.112.0.0/13",
  "222.232.0.0/13",
  "0.0.0.0/8",
  "2.56.0.0/14",
  "5.180.0.0/14",
  "10.0.0.0/8",
  "100.64.0.0/10",
  "127.0.0.0/8",
  "151.216.0.0/13",
  "172.16.0.0/12",
  "185.208.0.0/12",
  "185.224.0.0/11",
  "224.0.0.0/3",
  "14.4.0.0/14",
  "42.52.0.0/14",
  "42.128.0.0/12",
  "42.160.0.0/12",
  "42.208.0.0/12",
  "49.8.0.0/14",
  "101.192.0.0/14",
  "116.128.0.0/10",
  "124.68.0.0/14",
  "147.16.0.0/14",
  "153.52.0.0/14",
  "180.236.0.0/14",
  "196.196.0.0/14",
  "196.240.0.0/14",
  "14.4.0.0/14",
  "42.52.0.0/14",
  "42.128.0.0/12",
  "42.160.0.0/12",
  "42.208.0.0/12",
  "49.8.0.0/14",
  "101.192.0.0/14",
  "116.128.0.0/10",
  "124.68.0.0/14",
  "147.16.0.0/14",
  "153.52.0.0/14",
  "180.236.0.0/14",
  "196.196.0.0/14",
  "196.240.0.0/14",
  "0.0.0.0/8",
  "2.56.0.0/14",
  "5.180.0.0/14",
  "10.0.0.0/8",
  "14.4.0.0/14",
  "42.52.0.0/14",
  "42.128.0.0/12",
  "42.160.0.0/12",
  "42.208.0.0/12",
  "45.8.0.0/13",
  "45.80.0.0/12",
  "45.128.0.0/10",
  "45.224.0.0/12",
  "49.8.0.0/14",
  "100.64.0.0/10",
  "101.192.0.0/14",
  "102.0.0.0/9",
  "102.128.0.0/11",
  "102.160.0.0/12",
  "102.176.0.0/14",
  "102.192.0.0/11",
  "103.96.0.0/11",
  "103.128.0.0/10",
  "116.128.0.0/10",
  "124.68.0.0/14",
  "127.0.0.0/8",
  "147.16.0.0/14",
  "153.52.0.0/14",
  "172.16.0.0/12",
  "180.236.0.0/14",
  "185.208.0.0/12",
  "185.224.0.0/11",
  "196.196.0.0/14",
  "196.240.0.0/14",
  "224.0.0.0/3",
  "2.56.0.0/14",
  "5.72.0.0/14",
  "5.180.0.0/14",
  "49.8.0.0/14",
  "101.192.0.0/14",
  "101.236.0.0/14",
  "116.144.0.0/14",
  "223.168.0.0/14",
  "23.20.0.0/14",
  "23.104.0.0/14",
  "50.16.0.0/14",
  "52.0.0.0/10",
  "52.64.0.0/11",
  "52.192.0.0/11",
  "54.64.0.0/11",
  "54.160.0.0/11",
  "54.192.0.0/12",
  "54.208.0.0/13",
  "54.216.0.0/14",
  "54.224.0.0/11",
  "75.112.0.0/14",
  "79.180.0.0/14",
  "84.108.0.0/14",
  "104.196.0.0/14",
  "107.20.0.0/14",
  "107.172.0.0/14",
  "196.52.0.0/14",
  "65.52.0.0/14",
  "0.0.0.0/8",
  "2.56.0.0/14",
  "5.180.0.0/14",
  "10.0.0.0/8",
  "100.64.0.0/10",
  "127.0.0.0/8",
  "151.216.0.0/13",
  "172.16.0.0/12",
  "185.208.0.0/12",
  "185.224.0.0/11",
  "224.0.0.0/3",
  "66.192.0.0/14",
  "172.128.0.0/10",
  "172.192.0.0/12",
  "172.208.0.0/13",
  "12.0.0.0/8",
  "65.80.0.0/14",
  "68.88.0.0/13",
  "68.248.0.0/13",
  "69.104.0.0/13",
  "69.148.0.0/14",
  "69.152.0.0/14",
  "69.208.0.0/12",
  "69.224.0.0/12",
  "70.128.0.0/11",
  "70.240.0.0/12",
  "71.128.0.0/11",
  "72.144.0.0/12",
  "74.160.0.0/11",
  "74.224.0.0/11",
  "75.0.0.0/10",
  "76.192.0.0/10",
  "99.0.0.0/9",
  "99.128.0.0/10",
  "108.64.0.0/11",
  "216.76.0.0/14",
  "24.44.0.0/14",
  "24.188.0.0/14",
  "67.80.0.0/13",
  "68.192.0.0/13",
  "24.176.0.0/13",
  "66.188.0.0/14",
  "68.112.0.0/13",
  "71.8.0.0/13",
  "71.80.0.0/12",
  "75.128.0.0/12",
  "96.32.0.0/13",
  "97.80.0.0/12",
  "24.0.0.0/12",
  "24.16.0.0/13",
  "24.60.0.0/14",
  "50.128.0.0/9",
  "67.160.0.0/11",
  "68.32.0.0/11",
  "68.80.0.0/13",
  "69.136.0.0/13",
  "69.240.0.0/12",
  "71.56.0.0/13",
  "71.192.0.0/12",
  "71.224.0.0/12",
  "73.0.0.0/8",
  "75.64.0.0/13",
  "76.16.0.0/12",
  "76.96.0.0/11",
  "98.192.0.0/11",
  "98.224.0.0/12",
  "98.240.0.0/13",
  "174.48.0.0/12",
  "67.232.0.0/13",
  "71.0.0.0/14",
  "71.48.0.0/13",
  "76.0.0.0/13",
  "63.144.0.0/12",
  "63.224.0.0/12",
  "65.100.0.0/14",
  "65.112.0.0/12",
  "65.128.0.0/11",
  "67.0.0.0/13",
  "67.128.0.0/13",
  "67.144.0.0/14",
  "70.56.0.0/14",
  "71.32.0.0/13",
  "71.208.0.0/12",
  "75.160.0.0/12",
  "97.112.0.0/12",
  "151.116.0.0/14",
  "174.16.0.0/12",
  "205.168.0.0/14",
  "208.44.0.0/14",
  "63.160.0.0/12",
  "68.24.0.0/13",
  "68.240.0.0/13",
  "70.0.0.0/13",
  "70.8.0.0/14",
  "99.200.0.0/13",
  "207.12.0.0/14",
  "208.0.0.0/11",
  "208.32.0.0/14",
  "74.192.0.0/14",
  "24.24.0.0/14",
  "24.160.0.0/13",
  "65.24.0.0/14",
  "65.184.0.0/13",
  "67.8.0.0/14",
  "67.240.0.0/14",
  "68.200.0.0/13",
  "69.200.0.0/13",
  "70.112.0.0/12",
  "71.64.0.0/12",
  "72.128.0.0/13",
  "72.176.0.0/12",
  "74.64.0.0/12",
  "75.80.0.0/13",
  "75.176.0.0/12",
  "76.80.0.0/12",
  "76.168.0.0/13",
  "76.184.0.0/14",
  "98.24.0.0/13",
  "98.144.0.0/14",
  "174.96.0.0/13",
  "68.236.0.0/14",
  "70.16.0.0/13",
  "70.104.0.0/13",
  "71.96.0.0/11",
  "71.160.0.0/11",
  "71.240.0.0/12",
  "72.64.0.0/11",
  "96.224.0.0/11",
  "100.0.0.0/11",
  "100.32.0.0/13",
  "108.0.0.0/11",
  "108.32.0.0/12",
  "108.48.0.0/13",
  "141.152.0.0/14",
  "17.0.0.0/8",
  "12.0.0.0/8",
  "4.0.0.0/8",
  "25.0.0.0/8",
  "63.224.0.0/13",
  "14.4.0.0/14",
  "42.52.0.0/14",
  "42.128.0.0/12",
  "42.160.0.0/12",
  "42.208.0.0/12",
  "49.8.0.0/14",
  "101.192.0.0/14",
  "116.128.0.0/10",
  "124.68.0.0/14",
  "147.16.0.0/14",
  "153.52.0.0/14",
  "180.236.0.0/14",
  "196.196.0.0/14",
  "196.240.0.0/14",
  "23.20.0.0/14",
  "23.104.0.0/14",
  "50.16.0.0/14",
  "52.0.0.0/10",
  "52.64.0.0/11",
  "52.192.0.0/11",
  "54.64.0.0/11",
  "54.160.0.0/11",
  "54.192.0.0/12",
  "54.208.0.0/13",
  "54.216.0.0/14",
  "54.224.0.0/11",
  "75.112.0.0/14",
  "79.180.0.0/14",
  "84.108.0.0/14",
  "104.196.0.0/14",
  "107.20.0.0/14",
  "107.172.0.0/14",
  "196.52.0.0/14",
  "14.4.0.0/14",
  "42.52.0.0/14",
  "42.128.0.0/12",
  "42.160.0.0/12",
  "42.208.0.0/12",
  "49.8.0.0/14",
  "101.192.0.0/14",
  "116.128.0.0/10",
  "124.68.0.0/14",
  "147.16.0.0/14",
  "153.52.0.0/14",
  "180.236.0.0/14",
  "196.196.0.0/14",
  "196.240.0.0/14"
  ));
  if($ipset->match($ip))
    return true;
  return false;
}